# 公車即時位置查詢系統（OpenBusTracker）
## 軟體需求規格書 (SRS)

> 版本：0.0.1 ─ 最後更新：2025‑04‑19

---

### 1 目⁠的

本文件定義 **OpenBusTracker** 的軟體需求，作為產品開發、測試與驗收的依據，並提供利害關係人（使用者、開發者）統一參考之依據。

### 2 產品範圍

OpenBusTracker 是一套採用 FastAPI 後端、React + Leaflet.js 前端，並透過 Docker Compose 部署的開源公車即時位置查詢平台。系統提供即時定位、站牌搜尋、到站推播等功能，並可彈性整合各地公共運輸資料來源。

### 3 定義與縮寫
| 縮寫 | 定義 |
|------|------|
| **API** | Application Programming Interface |
| **ETA** | Estimated Time of Arrival，預估到站時間 |
| **GTFS‑RT** | General Transit Feed Specification Realtime，即時運輸資料格式 |
| **SSE** | Server‑Sent Events |
| **WS** | WebSocket |
| **MoSCoW** | Must / Should / Could / Won't，需求優先度模型 |

### 4 整體描述
* **目標使用者**：一般乘客、運輸主管機關、第三方開發者。
* **作業環境**：主要部署於 Linux 伺服器（Docker），前端支援最新版 Chrome瀏覽器。
* **相依系統**：TDX開源運輸流通資料。

---

## 5 功能需求（FR）
| 編號 | 功能敘述 | 詳細說明 | 優先度 |
|------|----------|----------|--------|
| FR‑1 | 路線查詢 | 使用者可輸入/選擇路線編號取得該路線基本資訊（名稱、行駛區間、方向）。 | **M** |
| FR‑2 | 即時車輛座標 | 系統每 ≤ 5 秒更新車輛 GPS 定位，於地圖呈現 Marker。 | M |
| FR‑3 | 站牌搜尋 | 根據使用者位置或關鍵字，列出附近 N 公尺內站牌及可搭乘路線。 | M |
| FR‑4 | ETA 計算 | 回傳指定車輛至下一站牌之 ETA（±30 秒誤差）。 | S |
| FR‑5 | 到站推播 | 使用者可訂閱某站牌＋路線組合，車輛距離 ≤ 2 站時以 WS / SSE 推播提醒。 | S |
| FR‑6 | 歷史軌跡重播 | 提供指定時間範圍之車輛行駛軌跡 Replay。 | C |
| FR‑7 | 多來源資料整合 | 支援匯入/切換不同城市 GTFS‑RT 端點；可動態熱插拔。 | C |
| FR‑8 | 系統管理介面 | 管理員可檢視服務健康度、資料同步狀態與佇列長度。 | S |
| FR‑9 | 使用者意見回饋 | 前端表單將留言寫入資料庫並寄送通知信。 | W |

> **MoSCoW 說明**：M = Must、有此功能才能上線；S = Should、重要但可延遲；C = Could、加值功能；W = Won’t、本版本不納入。

---

## 6 非功能需求（NFR）
| NFR 編號 | 類型 | 敘述 | 量化指標 | 優先度 |
|----------|------|------|----------|--------|
| NFR‑1 | **性能** | API (G / POST) 平均回應時間 ≤ 200 ms；P95 ≤ 400 ms。 | Locust / k6 測試報告 | **M** |
| NFR‑2 | **即時性** | 車輛定位資訊延遲 ≤ 1 秒（Producer→前端）。 | 監控儀表板 | M |
| NFR‑3 | **可用性** | 年平均可用度 ≥ 99.5 %。 | UptimeRobot | M |
| NFR‑4 | **伸縮性** | 於單一路線併發 5k 訂閱連線時，系統照常運作且延遲不超過 1 s。 | k6 測試 | S |
| NFR‑5 | **安全性** | API 需透過 HTTPS；管理介面須 OAuth2 + RBAC。 | 滲透測試報告 | M |
| NFR‑6 | **可維護性** | 後端程式覆蓋率 ≥ 70 %，前端 ≥ 60 %。 | pytest / Playwright | S |
| NFR‑7 | **國際化** | 前端可支援繁體中文、英文切換；新增語系耗時 ≤ 1 人日。 | UX 回測 | C |
| NFR‑8 | **法遵** | 資料遵循當地開放資料授權條款；GDPR 個資去識別化。 | 法務審查 | S |

---

## 7 需求優先度綜覽

```
Must   : FR‑1, FR‑2, FR‑3 | NFR‑1, NFR‑2, NFR‑3, NFR‑5
Should : FR‑4, FR‑5, FR‑8 | NFR‑4, NFR‑6, NFR‑8
Could  : FR‑6, FR‑7        | NFR‑7
Won't  : FR‑9 (本版不實作)
```

---

## 8 驗收方法
* **功能驗收**：對照上表 FR，編寫 Gherkin Given‑When‑Then 場景並自動化測試。  
* **性能驗收**：使用 k6 腳本產生流量，符合 NFR 指標。  
* **安全驗收**：OWASP ZAP 掃描及滲透測試通過 Medium 等級以下風險。


